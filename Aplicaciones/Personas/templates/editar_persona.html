{% extends 'plantilla.html' %}

{% block title %}Editar Persona{% endblock %}

{% block extra_head %}
<style>
    .form-container {
        max-width: 650px;
        margin: 0 auto;
    }
    .preview-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #ddd;
    }
</style>
{% endblock %}

{% block contenido %}
<div class="page-heading">
    <h3 class="text-center mb-4">Editar Persona</h3>
</div>

<section class="section">
    <div class="card shadow p-4 form-container">
        <div class="card-body">
            <!-- ⚠️ Importante: enctype para permitir subida de archivos -->
            <form id="formEditarPersona" method="POST" enctype="multipart/form-data" novalidate>
                {% csrf_token %}

                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre:</label>
                    <input type="text" class="form-control" id="nombre" name="nombre"
                           value="{{ persona.nombre }}" required>
                </div>

                <div class="mb-3">
                    <label for="apellido" class="form-label">Apellido:</label>
                    <input type="text" class="form-control" id="apellido" name="apellido"
                           value="{{ persona.apellido }}" required>
                </div>

                <div class="mb-3">
                    <label for="cedula" class="form-label">Cédula:</label>
                    <input type="text" class="form-control" id="cedula" name="cedula"
                           value="{{ persona.cedula }}" required>
                </div>

                <div class="mb-3">
                    <label for="correo" class="form-label">Correo electrónico:</label>
                    <input type="email" class="form-control" id="correo" name="correo"
                           value="{{ persona.correo }}" required>
                </div>

                <div class="mb-3">
                    <label for="telefono" class="form-label">Teléfono:</label>
                    <input type="text" class="form-control" id="telefono" name="telefono"
                           value="{{ persona.telefono }}">
                </div>

                <div class="mb-3">
                    <label for="direccion" class="form-label">Dirección:</label>
                    <input type="text" class="form-control" id="direccion" name="direccion"
                           value="{{ persona.direccion }}" required>
                </div>

                <div class="mb-3">
                    <label for="foto" class="form-label">Foto:</label><br>
                    {% if persona.foto %}
                        <img src="{{ persona.foto.url }}" alt="Foto actual" class="preview-img mb-2"><br>
                    {% else %}
                        <span class="text-muted">Sin foto</span><br>
                    {% endif %}
                    <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
                </div>

                <div class="mb-3">
                    <label for="documento_pdf" class="form-label">Documento PDF:</label><br>
                    {% if persona.documento_pdf %}
                        <a href="{{ persona.documento_pdf.url }}" target="_blank" class="btn btn-outline-info btn-sm mb-2">
                            Ver documento actual
                        </a><br>
                    {% else %}
                        <span class="text-muted">Sin documento</span><br>
                    {% endif %}
                    <input type="file" class="form-control" id="documento_pdf" name="documento_pdf" accept="application/pdf">
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="fa fa-save me-1"></i> Guardar Cambios
                    </button>
                    <a href="{% url 'inicio_personas' %}" class="btn btn-secondary">
                        <i class="fa fa-arrow-left me-1"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function () {
    $("#formEditarPersona").validate({
        rules: {
            nombre: { required: true, minlength: 3 },
            apellido: { required: true, minlength: 3 },
            cedula: { required: true, digits: true, minlength: 10, maxlength: 10 },
            correo: { required: true, email: true },
            telefono: { digits: true, minlength: 7, maxlength: 10 },
            direccion: { required: true, minlength: 5 }
        },
        messages: {
            nombre: { required: "Ingrese el nombre", minlength: "Debe tener al menos 3 caracteres" },
            apellido: { required: "Ingrese el apellido", minlength: "Debe tener al menos 3 caracteres" },
            cedula: { required: "Ingrese la cédula", digits: "Solo números", minlength: "Debe tener 10 dígitos", maxlength: "Debe tener 10 dígitos" },
            correo: { required: "Ingrese el correo", email: "Correo inválido" },
            telefono: { digits: "Solo números", minlength: "Mínimo 7 dígitos", maxlength: "Máximo 10 dígitos" },
            direccion: { required: "Ingrese la dirección", minlength: "Dirección demasiado corta" }
        }
    });
});
</script>
{% endblock %}
