{% extends 'plantilla.html' %}
{% block title %}Editar Solicitud{% endblock %}

{% block extra_head %}
<style>
    .form-container {
        max-width: 650px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block contenido %}
<div class="page-heading">
    <h3 class="text-center mb-4">Editar Solicitud de Adopción</h3>
</div>

<section class="section">
    <div class="card shadow p-4 form-container">
        <div class="card-body">

            <form id="formEditarAdopcion" method="POST">
                {% csrf_token %}

                <div class="mb-3">
                    <label class="form-label">Persona:</label>
                    <input type="text" class="form-control" value="{{ solicitud.persona.nombre }} {{ solicitud.persona.apellido }}" disabled>
                    <input type="hidden" name="persona" value="{{ solicitud.persona.id }}">
                </div>

                <div class="mb-3">
                    <label class="form-label">Mascota:</label>
                    <input type="text" class="form-control" value="{{ solicitud.mascota.nombre }} ({{ solicitud.mascota.especie }}) - {{ solicitud.mascota.raza }}" disabled>
                    <input type="hidden" name="mascota" value="{{ solicitud.mascota.id }}">
                </div>

                <div class="mb-3">
                    <label class="form-label">Estado:</label>
                    <select class="form-select" id="estado" name="estado" required>
                        <option value="Pendiente" {% if solicitud.estado == "Pendiente" %}selected{% endif %}>Pendiente</option>
                        <option value="Aprobado" {% if solicitud.estado == "Aprobado" %}selected{% endif %}>Aprobado</option>
                        <option value="Rechazado" {% if solicitud.estado == "Rechazado" %}selected{% endif %}>Rechazado</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Motivo:</label>
                    <textarea class="form-control" id="motivo" name="motivo" rows="4" required>{{ solicitud.motivo }}</textarea>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a href="{% url 'inicio_adopciones' %}" class="btn btn-secondary">
                        Cancelar
                    </a>
                    <button type="submit" class="btn btn-primary">
                        Guardar Cambios
                    </button>
                </div>
            </form>

        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function () {

    $("#estado").change(function () {
        if($(this).val() === "Aprobado"){
            Swal.fire({
                title: "¿Aprobar Solicitud?",
                text: "¿Desea aprobar definitivamente esta adopción?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Sí, aprobar",
                cancelButtonText: "Cancelar"
            }).then((result) => {
                if (!result.isConfirmed) {
                    $("#estado").val("Pendiente");
                }
            });
        }
    });

    $("#formEditarAdopcion").validate({
        rules: {
            estado: { required: true },
            motivo: { required: true, minlength: 10, maxlength: 500 }
        },
        messages: {
            estado: { required: "Seleccione un estado." },
            motivo: {
                required: "Ingrese el motivo.",
                minlength: "Mínimo 10 caracteres.",
                maxlength: "Máximo 500 caracteres."
            }
        },
        errorClass: "is-invalid",
        errorPlacement: function (error, element) {
            error.appendTo(element.parent());
        }
    });
});
</script>
{% endblock %}
