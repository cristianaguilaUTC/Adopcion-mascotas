{% extends 'plantilla.html' %}
{% load static %}
{% block title %}Solicitudes de AdopciÃ³n{% endblock %}

{% block contenido %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">ðŸ“‹ Solicitudes de AdopciÃ³n</h3>
        <a href="{% url 'nueva_solicitud' %}" class="btn btn-success">
            <i class="bi bi-file-earmark-plus-fill"></i> Nueva Solicitud
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            {% if solicitudes %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Persona</th>
                            <th>Mascota</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Motivo</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for solicitud in solicitudes %}
                        <tr>
                            <td>{{ solicitud.persona.nombre }} {{ solicitud.persona.apellido }}</td>
                            <td>{{ solicitud.mascota.nombre }} ({{ solicitud.mascota.especie }})</td>
                            <td>{{ solicitud.fecha_solicitud|date:"d/m/Y" }}</td>
                            <td>
                                {% if solicitud.estado == "Aprobado" %}
                                    <span class="badge bg-success">{{ solicitud.estado }}</span>
                                {% elif solicitud.estado == "Pendiente" %}
                                    <span class="badge bg-warning text-dark">{{ solicitud.estado }}</span>
                                {% else %}
                                    <span class="badge bg-danger">{{ solicitud.estado }}</span>
                                {% endif %}
                            </td>
                            <td>{{ solicitud.motivo }}</td>
                            <td class="text-center">
                                <a href="{% url 'editar_solicitud' solicitud.id %}" class="btn btn-warning btn-sm me-1">
                                    <i class="bi bi-pencil-square"></i> Editar
                                </a>
                                <button class="btn btn-danger btn-sm" 
                                        onclick="confirmarEliminacion('{{ solicitud.id }}', '{{ solicitud.persona.nombre }}', '{{ solicitud.mascota.nombre }}')">
                                    <i class="bi bi-trash-fill"></i> Eliminar
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center text-muted py-3">
                <i class="bi bi-emoji-frown fs-4"></i>
                <p class="mt-2 mb-0">No hay solicitudes de adopciÃ³n registradas.</p>
            </div>
            {% endif %}
        </div>
    </div>

    
</div>
{% endblock %}

{% block extra_js %}
<script>
function confirmarEliminacion(id, persona, mascota) {
    Swal.fire({
        title: 'Â¿Eliminar Solicitud?',
        text: `Â¿Seguro que deseas eliminar la solicitud de ${persona} para adoptar a ${mascota}?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'SÃ­, eliminar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = `/adopciones/eliminar/${id}/`;
        }
    });
}
</script>
{% endblock %}
